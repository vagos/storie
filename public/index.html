<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KV Store</title>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <div class="card">
    <h1>KV Store</h1>
    <p>Simple key-value store. Free accounts can use one key; premium unlocks unlimited keys. Log in to manage your data.</p>

    <section id="loginSection">
      <h2>Create or log in</h2>
      <label for="userId">User ID</label>
      <input id="userId" type="text" placeholder="alice123" />
      <label for="password">Password</label>
      <input id="password" type="password" placeholder="••••" />
      <div>All accounts start as <strong>free</strong>. Upgrade to premium after logging in.</div>
      <button id="createUserBtn">Create or Login</button>
      <div id="loginStatus">Not logged in.</div>
    </section>

    <section id="dashboard" style="display: none;">
      <div>
        <strong id="currentUser">Current user: none</strong>
        <button id="logoutBtn">Log out</button>
      </div>

      <h2>KV operations</h2>
      <label for="key">Key</label>
      <input id="key" type="text" placeholder="example-key" />

      <label for="value">Value (text or JSON)</label>
      <textarea id="value" placeholder='{ "message": "hello" }'></textarea>

      <label><input type="checkbox" id="requireSecret"> Protect this key (secret generated automatically)</label>

      <div class="actions">
        <button id="setBtn">Set Value</button>
        <button class="secondary" id="getBtn">Get Value</button>
        <button class="secondary" id="clearBtn">Clear Output</button>
      </div>

      <pre id="output">Waiting for input…</pre>

      <h2>Your keys</h2>
      <div id="tableStatus">No data loaded.</div>
      <table border="1" width="100%" cellpadding="6">
        <thead>
          <tr>
            <th>Key</th>
            <th>Value</th>
            <th>Updated</th>
          </tr>
        </thead>
        <tbody id="entriesBody">
        </tbody>
      </table>
      <div class="actions">
        <button class="secondary" id="prevPageBtn">Prev</button>
        <span id="pageInfo"></span>
        <button class="secondary" id="nextPageBtn">Next</button>
      </div>

      <h2>Upgrade to premium</h2>
      <p>Start a Stripe checkout and confirm to unlock unlimited keys. Requires server STRIPE_SECRET_KEY.</p>
      <button id="startCheckoutBtn">Start Stripe checkout</button>
      <div id="paymentInfo"></div>
    </section>

    <section id="usecases">
      <h2>Use cases</h2>
      <div class="usecase">
        <h3>Pipe a command to your personal site</h3>
        <p>Capture live CLI output and surface it on a page with one fetch.</p>
        <pre><code>uptime | curl -X POST https://your-kv-host/api/kv/&lt;user&gt;/site-status -H "Content-Type: text/plain" --data-binary @-</code></pre>
        <pre><code class="language-js">const res = await fetch('/api/kv/&lt;user&gt;/site-status');</code>
<code class="language-js">document.getElementById('status').textContent = await res.text();</code></pre>
      </div>

      <div class="usecase">
        <h3>Share deploy metadata with your frontend</h3>
        <p>Drop build info from CI so the client can render version badges.</p>
        <pre><code>echo '{"release":"'"$GITHUB_SHA"'","env":"prod"}' \</code>
<code>  | curl -X POST https://your-kv-host/api/kv/&lt;user&gt;/deploy -H "Content-Type: application/json" --data-binary @-</code></pre>
        <pre><code class="language-js">const meta = await fetch('/api/kv/&lt;user&gt;/deploy').then(r =&gt; r.json());</code>
<code class="language-js">document.querySelector('#build').textContent = meta.release;</code></pre>
      </div>

      <div class="usecase">
        <h3>Coordinate scripts across machines</h3>
        <p>Use KV as a tiny mailbox for automation steps.</p>
        <pre><code># box A writes the next action</code>
<code>echo "restart-api" | curl -X POST https://your-kv-host/api/kv/&lt;user&gt;/ops-task --data-binary @-</code>
<code># box B polls and reacts</code>
<code>curl https://your-kv-host/api/kv/&lt;user&gt;/ops-task | xargs -I{} bash -lc '{}'</code></pre>
      </div>
    </section>

    <section id="infoSection">
      <h2>Info</h2>
      <p>
        GitHub: <a href="https://github.com/vagos/storie" target="_blank" rel="noreferrer">https://github.com/vagos/storie</a><br />
        Support: <a href="mailto:vagos@lamprou.xyz">vagos@lamprou.xyz</a>
      </p>
      <p>
      Made by Evangelos Lamprou and Ioanna Gemou.
      </p>

    </section>
  </div>

  <script src="index.js" defer></script>
</body>
</html>
