<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KV Store</title>
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
  <div class="card">

    <header class="hero">
      <div class="hero-left">
        <h1>KV Store</h1>
        <p>
          Simple key-value store. Free accounts can use one key; premium unlocks unlimited keys.
          Log in to manage your data.
        </p>
        <p id="loginStatus">Not logged in.</p>
      </div>

      <div class="hero-right">
        <!-- Logged OUT state (default visible) -->
        <div class="auth-box" id="authBoxLoggedOut">
          <div class="auth-title"></div>
          <a class="auth-btn primary" href="/login.html">Log in or create account</a>
        </div>

        <!-- Logged IN state (default hidden; JS will show it) -->
        <div class="auth-box" id="authBoxLoggedIn" style="display:none;">
          <div class="auth-title">Current user</div>

          <div style="display:flex; gap:10px; align-items:center; justify-content:flex-end; flex-wrap:wrap;">
            <div id="heroUserPill" style="font-weight:700; color:#444;"></div>
            <button id="heroLogoutBtn" class="secondary" type="button">Log out</button>
          </div>
        </div>
      </div>

    </header>

    <div id="appBanner" class="banner" style="display:none;"></div>

    <section id="dashboard" style="display: none;">

      <h2>KV operations</h2>

      <label for="key">Key</label>
      <input id="key" type="text" placeholder="example-key" />

      <label for="value">Value (text or JSON)</label>
      <textarea id="value" placeholder='{ "message": "hello" }'></textarea>

      <label>
        <input type="checkbox" id="requireSecret">
        Protect this key (secret generated automatically)
      </label>

      <div class="actions">
        <button id="setBtn">Set Value</button>
        <button class="secondary" id="getBtn">Get Value</button>
        <button class="secondary" id="clearBtn">Clear Output</button>
      </div>

      <pre id="output">Waiting for inputâ€¦</pre>

      <h2>Your keys</h2>
      <div id="tableStatus">No data loaded.</div>

      <table border="1" width="100%" cellpadding="6">
        <thead>
          <tr>
            <th>Key</th>
            <th>Value</th>
            <th>Updated</th>
          </tr>
        </thead>
        <tbody id="entriesBody"></tbody>
      </table>

      <div class="actions">
        <button class="secondary" id="prevPageBtn">Prev</button>
        <span id="pageInfo"></span>
        <button class="secondary" id="nextPageBtn">Next</button>
      </div>

      <h2>Upgrade to premium</h2>
      <p>Start a Stripe checkout and confirm to unlock unlimited keys. Requires server STRIPE_SECRET_KEY.</p>
      <button id="startCheckoutBtn">Start Stripe checkout</button>
      <div id="paymentInfo"></div>
    </section>

    <section id="usecases">
      <h2>Example use cases</h2>
      <p class="muted">
        Practical examples showing how KV Store can be used in real systems.
      </p>

      <div class="usecase-grid">

        <div class="usecase">
          <h3>Pipe command output to a website</h3>
          <p>
            Capture live CLI output and expose it on a page with a single fetch.
          </p>
          <pre><code>uptime | curl -X POST https://your-kv-host/api/kv/&lt;user&gt;/site-status \
      -H "Content-Type: text/plain" --data-binary @-</code></pre>
          <pre><code class="language-js">const res = await fetch('/api/kv/&lt;user&gt;/site-status');
    document.getElementById('status').textContent = await res.text();</code></pre>
        </div>

        <div class="usecase">
          <h3>Share deployment metadata with your frontend</h3>
          <p>
            Push build information from CI so clients can render version or status badges.
          </p>
          <pre><code>echo '{"release":"'"$GITHUB_SHA"'","env":"prod"}' \
      | curl -X POST https://your-kv-host/api/kv/&lt;user&gt;/deploy \
        -H "Content-Type: application/json" --data-binary @-</code></pre>
          <pre><code class="language-js">const meta = await fetch('/api/kv/&lt;user&gt;/deploy').then(r =&gt; r.json());
    document.querySelector('#build').textContent = meta.release;</code></pre>
        </div>

        <div class="usecase">
          <h3>Coordinate scripts across machines</h3>
          <p>
            Use KV Store as a lightweight mailbox for automation and orchestration.
          </p>
          <pre><code># machine A publishes the next action
    echo "restart-api" | curl -X POST https://your-kv-host/api/kv/&lt;user&gt;/ops-task --data-binary @-

    # machine B polls and executes
    curl https://your-kv-host/api/kv/&lt;user&gt;/ops-task | xargs -I{} bash -lc '{}'</code></pre>
        </div>

        <div class="usecase">
          <h3>Feature flags and runtime configuration</h3>
          <p>
            Store small runtime switches that multiple services can read consistently.
          </p>
          <pre><code>echo "on" | curl -X POST https://your-kv-host/api/kv/&lt;user&gt;/feature-x</code></pre>
        </div>

      </div>
    </section>

    <section id="infoSection">
      <h2>Info</h2>
      <p>
        GitHub: <a href="https://github.com/vagos/storie" target="_blank" rel="noreferrer">https://github.com/vagos/storie</a><br />
        Support: <a href="mailto:vagos@lamprou.xyz">vagos@lamprou.xyz</a>
      </p>
      <p>
        Made by
        <a href="https://vagos.lamprou.xyz" target="_blank" rel="noreferrer">Evangelos Lamprou</a>
        and
        <a href="https://igemou.github.io/" target="_blank" rel="noreferrer">Ioanna Gemou</a>.
      </p>
    </section>

  </div>

  <script src="index.js" defer></script>
</body>
</html>
